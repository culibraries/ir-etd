function visualize(e){$("#top").html(""),$("#top").json2html(convert("json",e,"open"),transforms.object),regEvents()}function getValue(e){var a=$.type(e);switch(a){case"array":case"object":return;case"function":return"function";case"string":return"'"+e+"'";default:return e}}function children(e){var a=$.type(e);switch(a){case"array":case"object":return json2html.transform(e,transforms.object)}}function convert(e,a,t){var r=$.type(a);void 0===t&&(t="closed");var n=[];switch(r){case"array":for(var s=a.length,c=0;c<s;++c)n[c]=convert(c,a[c]);break;case"object":var c=0;for(var o in a)n[c]=convert(o,a[o]),c++;break;default:n=a}return{name:e,value:n,type:r,show:t}}function regEvents(){$(".header").click(function(){var e=$(this).parent();e.hasClass("closed")?(e.removeClass("closed"),e.addClass("open")):(e.removeClass("open"),e.addClass("closed"))})}var transforms={object:{tag:"div",class:"package ${show} ${type}",children:[{tag:"div",class:"header",children:[{tag:"div",class:function(e){var a=["arrow"];return void 0!==getValue(e.value)&&a.push("hide"),a.join(" ")}},{tag:"span",class:"name",html:"${name}"},{tag:"span",class:"value",html:function(e){var a=getValue(e.value);return void 0!==a?" : "+a:""}},{tag:"span",class:"type",html:"${type}"}]},{tag:"div",class:"children",children:function(e){return children(e.value)}}]}};
!function(e){e.fn.json2html=function(t,n,a){if("undefined"!=typeof json2html){var l={append:!0,replace:!1,prepend:!1,eventData:{}};return void 0!==a&&e.extend(l,a),l.events=!0,this.each(function(){for(var a=json2html.transform(t,n,l),i=e(document.createElement("i")).html(a.html),r=0;r<a.events.length;r++){var d=a.events[r],h=e(i).find("[json2html-event-id-"+d.type+"='"+d.id+"']");if(0===h.length)throw"jquery.json2html was unable to attach event "+d.id+" to DOM";e(h).removeAttr("json2html-event-id-"+d.type),e(h).on(d.type,d.data,function(t){t.data.event=t,t.data.action.call(e(this),t.data)})}l.replace?e.fn.replaceWith.call(e(this),e(i).children()):l.prepend?e.fn.prepend.call(e(this),e(i).children()):e.fn.append.call(e(this),e(i).children())})}}}(jQuery);
var json2html={transform:function(t,n,e){var i={events:[],html:""},r={events:!1};if(r=json2html._extend(r,e),void 0!==n||void 0!==t){var s="string"==typeof t?JSON.parse(t):t;i=json2html._transform(s,n,r)}return r.events?i:i.html},_extend:function(t,n){var e={};for(var i in t)e[i]=t[i];for(var i in n)e[i]=n[i];return e},_append:function(t,n){var e={html:"",event:[]};return"undefined"!=typeof t&&"undefined"!=typeof n&&(e.html=t.html+n.html,e.events=t.events.concat(n.events)),e},_isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},_transform:function(t,n,e){var i={events:[],html:""};if(json2html._isArray(t))for(var r=t.length,s=0;s<r;++s)i=json2html._append(i,json2html._apply(t[s],n,s,e));else"object"==typeof t&&(i=json2html._append(i,json2html._apply(t,n,void 0,e)));return i},_apply:function(t,n,e,i){var r={events:[],html:""};if(json2html._isArray(n))for(var s=n.length,o=0;o<s;++o)r=json2html._append(r,json2html._apply(t,n[o],e,i));else if("object"==typeof n&&void 0!==n.tag){var l=json2html._getValue(t,n,"tag",e);r.html+="<"+l;var a,h={events:[],html:""};for(var f in n)switch(f){case"tag":break;case"children":if(json2html._isArray(n.children))h=json2html._append(h,json2html._apply(t,n.children,e,i));else if("function"==typeof n.children){var d=n.children.call(t,t,e);"object"==typeof d?void 0!==d.html&&void 0!==d.events&&(h=json2html._append(h,d)):"string"==typeof d&&(h.html+=d)}break;case"html":a=json2html._getValue(t,n,"html",e);break;default:var u=!1;if(f.length>2&&"on"==f.substring(0,2).toLowerCase()){if(i.events){var m={action:n[f],obj:t,data:i.eventData,index:e},c=json2html._guid();r.events[r.events.length]={id:c,type:f.substring(2),data:m},r.html+=" json2html-event-id-"+f.substring(2)+"='"+c+"'"}u=!0}if(!u){var v=json2html._getValue(t,n,f,e);if(void 0!==v){var p;p="string"==typeof v?'"'+v.replace(/"/g,"&quot;")+'"':v,r.html+=" "+f+"="+p}}}r.html+=">",a&&(r.html+=a),r=json2html._append(r,h),r.html+="</"+l+">"}return r},_guid:function(){var t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return t()+t()+"-"+t()+t()+"-"+t()+t()},_getValue:function(t,n,e,i){var r="",s=n[e],o=typeof s;if("function"===o)return s.call(t,t,i);if("string"===o){var l=new json2html._tokenizer([/\$\{([^\}\{]+)\}/],function(n,e,i){return e?n.replace(i,function(n,e){for(var i=e.split("."),r=t,s="",o=i.length,l=0;l<o;++l)if(i[l].length>0){var a=r[i[l]];if(r=a,null===r||void 0===r)break}return null!==r&&void 0!==r&&(s=r),s}):n});r=l.parse(s).join("")}else r=s;return r},_tokenizer:function(t,n){return this instanceof json2html._tokenizer?(this.tokenizers=t.splice?t:[t],n&&(this.doBuild=n),this.parse=function(t){this.src=t,this.ended=!1,this.tokens=[];do this.next();while(!this.ended);return this.tokens},this.build=function(t,n){t&&this.tokens.push(this.doBuild?this.doBuild(t,n,this.tkn):t)},this.next=function(){var t,n=this;n.findMin(),t=n.src.slice(0,n.min),n.build(t,!1),n.src=n.src.slice(n.min).replace(n.tkn,function(t){return n.build(t,!0),""}),n.src||(n.ended=!0)},void(this.findMin=function(){var t,n,e=this,i=0;for(e.min=-1,e.tkn="";void 0!==(t=e.tokenizers[i++]);)n=e.src[t.test?"search":"indexOf"](t),n!=-1&&(e.min==-1||n<e.min)&&(e.tkn=t,e.min=n);e.min==-1&&(e.min=e.src.length)})):new json2html._tokenizer(t,n)}};
function Archive(e){this.name=e.name,this.status=e.status,this.contents=e.contents,this.archiveUrl=e.archiveUrl,this.readyUrl=e.readyUrl,this.getPdf=function(){for(var e=0;e<this.contents.length;e++)if("pdf"===this.contents[e].substr(-3))return this.contents[e]},this.pdf=this.getPdf(),this.json=JSON.parse(stripChars(e.json)),this.db=e.db,this.subId=e.subId}function refreshSideBar(){getOldestArchive().done(function(e){$("#oldestArchive").text(e)}),getArchives().done(function(e){displayArchives(e)})}function displayArchives(e){for(var t="",r="",i="",s=0;s<e.length;s++)switch(e[s].workflow_status){case"W":t+='<a href="#" class="getme" subId="'+e[s].submission_id+'" archive="'+e[s].sequence_num+'" status="'+e[s].workflow_status+'">'+e[s].identikey+"-"+e[s].sequence_num+"</a><br>";break;case"P":r+='<a href="#" class="getme" subId="'+e[s].submission_id+'" archive="'+e[s].sequence_num+'" status="'+e[s].workflow_status+'">'+e[s].identikey+"-"+e[s].sequence_num+"</a><br>";break;case"L":i+='<a href="#" class="getme" subId="'+e[s].submission_id+'" archive="'+e[s].sequence_num+'" status="'+e[s].workflow_status+'">'+e[s].identikey+"-"+e[s].sequence_num+"</a><br>"}$("#working").html(t),$("#pending").html(r),$("#problem").html(i)}function clearViews(){$(".xmlEditBtns").hide(),$("#xmlEdit").empty(),$("#top").empty(),$("#archiveFiles").empty()}function calcRows(e){return Math.round(e/20)-1}function stripChars(e){var t={"@attributes":"attributes",DISS_:""};return e=e.replace(/@attributes|DISS_/g,function(e){return t[e]})}function getOldestArchive(){var e=$.Deferred();return $.ajax({url:"modules/archive/archive.php",type:"GET",data:{action:"getOldestArchive"},success:function(t,r){e.resolve(t)},error:function(e,t,r){console.log(e),console.log("Details: "+t+"\nError: "+r)}}),e.promise()}function getArchives(){var e=$.Deferred();return $.ajax({url:"modules/archive/archive.php",type:"GET",data:{action:"getArchives"},success:function(t,r){e.resolve(JSON.parse(t))},error:function(e,t,r){console.log(e),console.log("Details: "+t+"\nError: "+r)}}),e.promise()}function getOneArchive(e,t,r){var i=$.Deferred();return"oldest"===t?$.ajax({url:"modules/archive/archive.php",type:"GET",datatype:"JSON",data:{action:"getExtractOldestArchive"},success:function(e,t){i.resolve(JSON.parse(e))},error:function(e,t,r){console.log(e),console.log("Details: "+t+"\nError: "+r)}}):$.ajax({url:"modules/archive/archive.php",type:"GET",datatype:"JSON",data:{action:"getOneArchive",status:r,subId:t,archive:e},success:function(e,t){i.resolve(JSON.parse(e))},error:function(e,t,r){console.log(e),console.log("Details: "+t+"\nError: "+r)}}),i.promise()}var currentArchive;refreshSideBar(),Archive.prototype.parseArchiveFiles=function(){for(var e="",t=2;t<this.contents.length;t++){var r=this.contents[t],i=r.substr(-3);"xml"!==i&&(e+='<a target="_blank" href="'+this.archiveUrl+r+'">'+r+"</a><br>")}return e},Archive.prototype.preFillForm=function(e){var t=$.Deferred();$("#xmlEdit").empty();for(var r in e){var i='<div class="form-group"><label for="'+e[r].id+'">'+e[r].name+"</label></div>";switch($("#xmlEdit").append(i),e[r].type){case"text-long":$("label:last").after('<textarea class="form-control" id="'+e[r].id+'" name="'+e[r].id+'"></textarea>'),$("#"+e[r].id).val(e[r].data);var s=calcRows($("#"+e[r].id)[0].scrollHeight);$("#"+e[r].id).attr("rows",s);break;case"text":case"date":$("label:last").after('<input class="form-control" id="'+e[r].id+'" name="'+e[r].id+'">'),$("#"+e[r].id).attr("type",e[r].type).val(e[r].data).attr("readonly",e[r].readonly);break;case"drop-down":var n='<select class="form-control" name="'+e[r].id+'" id="'+e[r].id+'"><option value="W">Working</option><option value="P">Pending</option><option value="L">Problem</option></select>';$("label:last").after(n),$("#"+e[r].id).val(e[r].data)}}return t.resolve(),$(".xmlEditBtns").show(),t.promise()},Archive.prototype.postFormData=function(){var e=$.Deferred();return $.ajax({url:"modules/archive/archive.php",type:"POST",data:{action:"postFormData",subId:this.subId,data:$("#xmlEdit").serialize()},success:function(t,r){console.log(t),e.resolve(JSON.parse(t))},error:function(e,t,r){console.log(e),console.log("Details: "+t+"\nError: "+r)}}),e.promise()},$(document).ready(function(){$("#loadOldestArchive").click(function(){getOneArchive(null,"oldest",null).done(function(e){currentArchive=new Archive(e),visualize(currentArchive.json),$("#archiveFiles").html(currentArchive.parseArchiveFiles()),currentArchive.preFillForm(currentArchive.mapJson()).done(function(e){currentArchive.postFormData().done(function(e){currentArchive.subId=e.id,refreshSideBar()})})})}),$(".submit").click(function(){currentArchive.postFormData().done(function(e){refreshSideBar(),clearViews()})})}),$(document).on("click",".getme",function(e){var t=e.target.attributes.subId.textContent,r=e.target.attributes.archive.textContent,i=e.target.attributes.status.textContent;getOneArchive(r,t,i).done(function(e){currentArchive=new Archive(e),visualize(currentArchive.json),$("#archiveFiles").html(currentArchive.parseArchiveFiles()),currentArchive.preFillForm(currentArchive.mapDb()),console.log(e)})});
Archive.prototype.mapDb=function(){return[{name:"Editor",id:"identikey",data:identikey,type:"text",readonly:!0},{name:"Archive Name",id:"sequence_num",data:this.name,type:"text",readonly:!0},{name:"Workflow Status",id:"workflow_status",data:this.status,type:"drop-down",readonly:!0},{name:"Title",id:"title",data:this.db.title,type:"text-long",readonly:!1},{name:"Full Text Url",id:"fulltext_url",data:this.readyUrl+this.pdf,type:"url",readonly:!0},{name:"Keywords",id:"keywords",data:this.db.keywords,type:"text-long",readonly:!1},{name:"Abstract",id:"abstract",data:this.db.abstract,type:"text-long",readonly:!1},{name:"Author1 FName",id:"author1_fname",data:this.db.author1_fname,type:"text",readonly:!1},{name:"Author1 MName",id:"author1_mname",data:this.db.author1_mname,type:"text",readonly:!1},{name:"Author1 LName",id:"author1_lname",data:this.db.author1_lname,type:"text",readonly:!1},{name:"Author1 Suffix",id:"author1_suffix",data:this.db.author1_suffix,type:"text",readonly:!1},{name:"Author1 Email",id:"author1_email",data:this.db.author1_email,type:"email",readonly:!1},{name:"Author1 Institution",id:"author1_institution",data:this.db.author1_institution,type:"text",readonly:!1},{name:"Advisor1",id:"advisor1",data:this.db.advisor1,type:"text",readonly:!1},{name:"Advisor2",id:"advisor2",data:this.db.advisor2,type:"text",readonly:!1},{name:"Advisor3",id:"advisor3",data:this.db.advisor3,type:"text",readonly:!1},{name:"Advisor4",id:"advisor4",data:this.db.advisor4,type:"text",readonly:!1},{name:"Advisor5",id:"advisor5",data:this.db.advisor5,type:"text",readonly:!1},{name:"Disciplines",id:"disciplines",data:this.db.disciplines,type:"text",readonly:!1},{name:"Comments",id:"comments",data:this.db.comments,type:"text",readonly:!1},{name:"Degree Name",id:"degree_name",data:this.db.degree_name,type:"text",readonly:!1},{name:"Department",id:"department",data:this.db.department,type:"text",readonly:!1},{name:"Document Type",id:"document_type",data:this.db.document_type,type:"text",readonly:!1},{name:"Embargo Date",id:"embargo_date",data:this.db.embargo_date,type:"date",readonly:!1},{name:"Publication Date",id:"publication_date",data:this.db.publication_date,type:"date",readonly:!1},{name:"Season",id:"season",data:this.db.season,type:"text",readonly:!1}]};
Archive.prototype.mapJson=function(){return[{name:"Editor",id:"identikey",data:identikey,type:"text",readonly:!0},{name:"Archive Name",id:"sequence_num",data:this.name,type:"text",readonly:!0},{name:"Workflow Status",id:"workflow_status",data:this.status,type:"drop-down",readonly:!0},{name:"Title",id:"title",data:this.json.description.title.toTitleCase(),type:"text-long",readonly:!1},{name:"Full Text Url",id:"fulltext_url",data:this.readyUrl+this.pdf,type:"url",readonly:!0},{name:"Keywords",id:"keywords",data:this.json.description.categorization.keyword,type:"text-long",readonly:!1},{name:"Abstract",id:"abstract",data:concatParas(this.json.content.abstract.para),type:"text-long",readonly:!1},{name:"Author1 FName",id:"author1_fname",data:this.json.authorship.author.name.fname,type:"text",readonly:!1},{name:"Author1 MName",id:"author1_mname",data:this.json.authorship.author.name.middle[0]?this.json.authorship.author.name.middle:void 0,type:"text",readonly:!1},{name:"Author1 LName",id:"author1_lname",data:this.json.authorship.author.name.surname,type:"text",readonly:!1},{name:"Author1 Suffix",id:"author1_suffix",data:this.json.authorship.author.name.suffix[0]?this.json.authorship.author.name.suffix:void 0,type:"text",readonly:!1},{name:"Author1 Email",id:"author1_email",data:this.json.authorship.author.contact[1].email||this.json.authorship.author.contact[0].email,type:"email",readonly:!1},{name:"Author1 Institution",id:"author1_institution",data:this.json.description.institution.inst_name,type:"text",readonly:!1},{name:"Advisor1",id:"advisor1",data:this.json.description.cmte_member[0]?this.json.description.cmte_member[0].name.surname+", "+this.json.description.cmte_member[0].name.fname:void 0,type:"text",readonly:!1},{name:"Advisor2",id:"advisor2",data:this.json.description.cmte_member[1]?this.json.description.cmte_member[1].name.surname+", "+this.json.description.cmte_member[1].name.fname:void 0,type:"text",readonly:!1},{name:"Advisor3",id:"advisor3",data:this.json.description.cmte_member[2]?this.json.description.cmte_member[2].name.surname+", "+this.json.description.cmte_member[2].name.fname:void 0,type:"text",readonly:!1},{name:"Advisor4",id:"advisor4",data:this.json.description.cmte_member[3]?this.json.description.cmte_member[3].name.surname+", "+this.json.description.cmte_member[3].name.fname:void 0,type:"text",readonly:!1},{name:"Advisor5",id:"advisor5",data:this.json.description.cmte_member[4]?this.json.description.cmte_member[4].name.surname+", "+this.json.description.cmte_member[4].name.fname:void 0,type:"text",readonly:!1},{name:"Disciplines",id:"disciplines",data:this.json.description.institution.inst_contact,type:"text",readonly:!1},{name:"Comments",id:"comments",data:"",type:"text",readonly:!1},{name:"Degree Name",id:"degree_name",data:this.json.description.degree.replace(/\./g,""),type:"text",readonly:!1},{name:"Department",id:"department",data:this.json.description.institution.inst_contact,type:"text",readonly:!1},{name:"Document Type",id:"document_type",data:"doctoral"===this.json.description.attributes.type?"Dissertation":"Thesis",type:"text",readonly:!1},{name:"Embargo Date",id:"embargo_date",data:embargoDate(this.json.attributes.embargo_code),type:"date",readonly:!1},{name:"Publication Date",id:"publication_date",data:this.json.description.dates.comp_date+"-01-01",type:"date",readonly:!1},{name:"Season",id:"season",data:"Spring",type:"text",readonly:!1}]},String.prototype.toTitleCase=function(){var t,e,a,n,i;for(a=this.replace(/([^\W_]+[^\s-]*) */g,function(t){return t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()}),n=["A","An","The","And","But","Or","For","Nor","As","At","By","For","From","In","Into","Near","Of","On","Onto","To","With"],t=0,e=n.length;t<e;t++)a=a.replace(new RegExp("\\s"+n[t]+"\\s","g"),function(t){return t.toLowerCase()});for(i=["Id","Tv"],t=0,e=i.length;t<e;t++)a=a.replace(new RegExp("\\b"+i[t]+"\\b","g"),i[t].toUpperCase());return a};var embargoDate=function(t){var e=new Date,a=("0"+e.getDate()).slice(-2),n=("0"+(e.getMonth()+1)).slice(-2),i=e.getFullYear()+"-"+n+"-"+a;if("0"===t)return i},concatParas=function(t){if("object"==typeof t){for(var e="",a=0;a<t.length;a++)e+="<p>"+t[a]+"</p>";return e}return t};
//# sourceMappingURL=map/bundle.min.js.map
